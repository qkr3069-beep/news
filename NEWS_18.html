<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>데일리 뉴스 브리핑 v2.1R · Recall 우선</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .skeleton{position:relative;overflow:hidden;background:#e5e7eb}
    .skeleton::after{content:"";position:absolute;inset:0;transform:translateX(-100%);background:linear-gradient(90deg,rgba(229,231,235,0) 0,rgba(255,255,255,.7) 50%,rgba(229,231,235,0) 100%);animation:shimmer 1.2s infinite}
    @keyframes shimmer{100%{transform:translateX(100%)}}
    .badge{font-size:.65rem;padding:.2rem .5rem;border-radius:9999px;border:1px solid rgba(0,0,0,.08)}
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="max-w-7xl mx-auto p-4 sm:p-8">
    <!-- 메인 배너 -->
    <a href="https://omnicare.biz/main/index.php?utm_source=omnicare&utm_medium=news&utm_campaign=daily" target="_blank" rel="noopener" class="relative block group rounded-2xl overflow-hidden border border-gray-200 shadow-sm mb-6" aria-label="비타브릿지 건강검진 예약 바로가기">
      <img src="https://postfiles.pstatic.net/MjAyNTA5MDVfMjU2/MDAxNzU3MDM1MzI5ODQ1.uqf71crOiDQYlLsoFGuIKzlASSUil46DsxNDebXlBcYg.wBc6WmhjLSfYDp6xPIF5sznkh50XOkMy-xq0k9GMTV8g.PNG/%EC%98%B4%EB%8B%88%EC%BC%80%EC%96%B4_%EB%A1%9C%EA%B3%A0.png?type=w966" alt="건강검진 예약은 비타브릿지" class="w-full h-40 sm:h-56 md:h-64 object-cover transition-transform duration-300 group-hover:scale-[1.01]" />
      <div class="pointer-events-none absolute inset-0 flex items-end">
        <div class="m-4 px-3 py-1.5 rounded-full bg-white/90 text-gray-900 text-xs font-medium shadow">건강검진 예약은 비타브릿지</div>
      </div>
    </a>

    <header class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
      <div>
        <h1 class="text-2xl sm:text-3xl font-semibold tracking-tight">데일리 뉴스 브리핑 <span class="text-xs align-super text-indigo-600">v2.1R</span></h1>
        <p class="text-sm text-gray-500">헬스케어 본업 + 사회·경제·기술·글로벌 이슈. (Recall 우선 · KST 롤링 윈도우)</p>
      </div>
      <div class="flex flex-wrap items-center gap-3">
        <input id="dateInput" type="date" class="px-3 py-2 rounded-xl border border-gray-300 bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />
        <input id="keywordInput" type="text" placeholder="검색 키워드 (예: 거래처/제품/인물)" class="px-3 py-2 rounded-xl border border-gray-300 bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 w-44 sm:w-64" />
        <div class="flex items-center gap-2 text-sm">
          <label class="inline-flex items-center gap-1"><input id="toggleBusiness" type="checkbox" class="rounded" checked> 사업체</label>
          <label class="inline-flex items-center gap-1"><input id="toggleGov" type="checkbox" class="rounded" checked> 국가기관</label>
          <!-- 키워드 적용 범위 옵션 -->
          <label class="inline-flex items-center gap-1"><input id="applyKeywordTop" type="checkbox" class="rounded"> Top Stories에 키워드 적용</label>
          <label class="inline-flex items-center gap-1"><input id="applyKeywordGov" type="checkbox" class="rounded" checked> 기관에 키워드 적용</label>
        </div>
        <button id="fetchBtn" class="px-4 py-2 rounded-xl bg-indigo-600 text-white text-sm font-medium hover:bg-indigo-700 active:bg-indigo-800">브리핑 불러오기</button>
        <button id="exportBtn" class="px-4 py-2 rounded-xl bg-gray-800 text-white text-sm font-medium hover:bg-gray-900">Markdown 내보내기</button>
      </div>
    </header>

    <section id="meta" class="mt-4 text-sm text-gray-600"></section>

    <main id="results" class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6"></main>

    <aside class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-4 text-xs text-gray-500">
      <div class="p-4 bg-white border rounded-2xl">
        <div class="font-semibold mb-1">버전 노트 (v2.1R)</div>
        <ul class="list-disc ml-4 space-y-1">
          <li><b>Recall 우선</b>: v2.1의 검색 방식을 복구(쿼리 결합 제거)</li>
          <li>속도는 유지: <b>캐시(5분)</b> + <b>타임아웃</b> + <b>프록시 폴백</b> + <b>병렬 처리</b></li>
          <li>키워드 적용 범위 옵션: Top Stories/기관에 분리 적용 가능</li>
        </ul>
      </div>
      <div class="p-4 bg-white border rounded-2xl"><div class="font-semibold mb-1">데이터 소스</div><p>Google News RSS(ko, en-US, en-GB), Google Top stories, WHO/FDA/EMA/CDC/ACOG/SMFM, 국내: 법제처·보건복지부·식약처·질병관리청.</p></div>
      <div class="p-4 bg-white border rounded-2xl"><div class="font-semibold mb-1">Tip</div><p>기관 RSS 주소가 바뀌면 코드 상단 officialFeedsKR/officialFeedsGlobal에서 업데이트하세요.</p></div>
    </aside>
  </div>

  <script>
    // ===== CONFIG =====
    const CONFIG = {
      maxPerCategory: 4,
      languageKO: 'ko', countryKO: 'KR',
      languageEN: 'en', countryUS: 'US', countryGB: 'GB',
      useTopStories: true,
      useOfficials: true,
      globalQueries: [
        'acetaminophen OR paracetamol OR Tylenol OR autism OR ASD OR pregnancy OR Trump',
        'AI health OR medical AI OR digital therapeutics OR wearable health',
        'vaccine safety OR adverse events OR FDA warning OR EMA safety'
      ],
      officialFeedsGlobal: [
        { name: 'WHO News', url: 'https://www.who.int/feeds/entity/mediacentre/news/en/rss.xml' },
        { name: 'FDA Press', url: 'https://www.fda.gov/about-fda/contact-fda/press-announcements?rss=1' },
        { name: 'EMA News', url: 'https://www.ema.europa.eu/en/news_events/news?output=rss' },
        { name: 'CDC Newsroom', url: 'https://tools.cdc.gov/api/v2/resources/media/403372.rss' },
        { name: 'ACOG News', url: 'https://www.acog.org/News/news-articles?rss=1' },
        { name: 'SMFM Statements', url: 'https://www.smfm.org/rss' }
      ],
      officialFeedsKR: [
        { name: '법제처 보도자료', url: 'https://www.moleg.go.kr/news/rss' },
        { name: '보건복지부 보도자료', url: 'https://www.mohw.go.kr/rss/press.xml' },
        { name: '식약처 보도자료', url: 'https://www.mfds.go.kr/brd/m_99/rss.do' },
        { name: '질병관리청 보도자료', url: 'https://www.kdca.go.kr/board/rss/boardRss.es?bid=0015' }
      ],
      categories: [
        { id: 'healthcare', title: '1) 헬스케어·의료 산업',
          queriesKO: ['원격의료 OR 디지털 치료제 OR DTx','보건의료 정책 OR 건강보험 OR 급여화','제약바이오 FDA OR 임상 승인 OR 허가'],
          queriesEN: ['telemedicine OR digital therapeutics OR DTx','health policy OR reimbursement OR payer','biotech FDA approval OR clinical trial OR authorization'] },
        { id: 'economy', title: '2) 경제·경영 트렌드',
          queriesKO: ['기준금리 OR 금리 동결 OR 인하 OR 인상','환율 OR 외환시장 OR 수출입','M&A OR 스타트업 투자 OR 벤처캐피털'],
          queriesEN: ['interest rate OR central bank decision','FX market OR exchange rate','M&A OR venture capital OR startup funding'] },
        { id: 'society', title: '3) 사회·문화 이슈',
          queriesKO: ['고령화 OR 1인 가구 OR 저출산','웰빙 OR 다이어트 트렌드 OR 피트니스','MZ세대 건강 OR 디지털 헬스 소비'],
          queriesEN: ['ageing population OR low birth rate','wellness trend OR fitness culture','consumer health app adoption'] },
        { id: 'tech', title: '4) 기술·디지털 트렌드',
          queriesKO: ['생성형 AI OR AI 도입 효과 OR 자동화','의료 데이터 보안 OR 개인정보보호 OR GDPR','웨어러블 OR 애플워치 OR 디지털 헬스'],
          queriesEN: ['generative AI OR automation in healthcare','health data security OR HIPAA OR GDPR','wearable health OR Apple Watch OR remote monitoring'] },
        { id: 'global', title: '5) 글로벌 이슈',
          queriesKO: ['공급망 리스크 OR 원자재 OR API 부족','기후 변화 건강 영향 OR 폭염 건강','분쟁 OR 지정학 OR 팬데믹 이후'],
          queriesEN: ['supply chain risk OR API shortage','climate change health impact OR heat wave health','geopolitics OR conflict OR post‑pandemic'] }
      ]
    };

    // ===== UTILS =====
    const KST_OFFSET_MIN = 9 * 60;
    const CACHE_TTL_MS = 5 * 60 * 1000;

    function toKST(d){ return new Date(d.getTime() + (KST_OFFSET_MIN + d.getTimezoneOffset())*60000); }
    function toLocalKSTDateString(d){ return toKST(d).toISOString().slice(0,10); }
    function formatTimeKST(d){ d=toKST(d); const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,'0'),dy=String(d.getDate()).padStart(2,'0'),hh=String(d.getHours()).padStart(2,'0'),mm=String(d.getMinutes()).padStart(2,'0'); return `${y}-${m}-${dy} ${hh}:${mm} KST`; }
    function getHostname(u){ try{return new URL(u).hostname.replace(/^www\./,'')}catch{return''} }
    function sanitize(s){ const el=document.createElement('div'); el.textContent=s||''; return el.innerHTML; }
    function dedupe(arr){ const seen=new Set(); return arr.filter(it=>{ const key=(getHostname(it.link)+'|'+it.title).toLowerCase(); if(seen.has(key)) return false; seen.add(key); return true; }); }

    function inRollingWindowKST(pubDate, targetDateStr){
      const [y,m,d]=targetDateStr.split('-').map(Number);
      const kstMidnight=new Date(Date.UTC(y,m-1,d,0,0,0));
      const windowStartKST=new Date(kstMidnight.getTime() - (9*60 - 15*60)*60000);
      const windowEndKST=new Date(windowStartKST.getTime()+24*60*60000-1000);
      const p=new Date(pubDate.getTime() + (9*60 + pubDate.getTimezoneOffset())*60000);
      const s=new Date(windowStartKST.getTime() + (9*60 + windowStartKST.getTimezoneOffset())*60000);
      const e=new Date(windowEndKST.getTime() + (9*60 + windowEndKST.getTimezoneOffset())*60000);
      return p>=s && p<=e;
    }

    function getCache(key){ try{ const v=sessionStorage.getItem(key); if(!v) return null; const {t,data}=JSON.parse(v); if(Date.now()-t<CACHE_TTL_MS) return data; }catch{} return null; }
    function setCache(key,data){ try{ sessionStorage.setItem(key, JSON.stringify({t:Date.now(),data})); }catch{} }
    function fetchWithTimeout(url, ms=6000, opts={}){ const ctrl=new AbortController(); const id=setTimeout(()=>ctrl.abort(),ms); return fetch(url,{...opts,signal:ctrl.signal}).finally(()=>clearTimeout(id)); }

    async function fetchViaProxies(url){
      const cacheKey=`rss:${url}`; const cached=getCache(cacheKey); if(cached) return cached;
      const targets=[
        `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}&nocache=${Date.now()}`,
        `https://cors.isomorphic-git.org/${url}`,
        `https://thingproxy.freeboard.io/fetch/${url}`
      ];
      let lastErr;
      for(const t of targets){
        try{ const r=await fetchWithTimeout(t,6000); if(!r.ok) throw new Error(`Proxy ${t} -> ${r.status}`); const text=await r.text(); setCache(cacheKey,text); return text; }
        catch(e){ lastErr=e; console.warn('proxy fail:',e.message); }
      }
      throw lastErr||new Error('All proxies failed');
    }

    function googleNewsRSS(q,lang,country){ const base='https://news.google.com/rss/search'; const p=new URLSearchParams({q,hl:lang,gl:country,ceid:`${country}:${lang}`}); return `${base}?${p.toString()}`; }
    function googleTopStoriesRSS(lang,country){ const base='https://news.google.com/rss'; const p=new URLSearchParams({hl:lang,gl:country,ceid:`${country}:${lang}`}); return `${base}?${p.toString()}`; }

    // ===== RENDER =====
    function renderSkeleton(){
      const wrap=document.getElementById('results');
      wrap.innerHTML='';
      const blocks=[
        {id:'top', title:'🔥 Top Stories (글로벌 보정)'},
        ...CONFIG.categories.map(c=>({id:c.id, title:c.title})),
        {id:'officialsKR', title:'🏛️ 국내 공신력 소스(기관 발표)'},
        {id:'officials', title:'🌐 해외 공신력 소스(기관 발표)'}
      ];
      for(const b of blocks){
        const card=document.createElement('section');
        card.className='rounded-2xl bg-white border border-gray-200 p-5 shadow-sm';
        card.innerHTML=`
          <h2 class="text-lg font-semibold mb-4 flex items-center justify-between">${sanitize(b.title)} <span class="badge bg-gray-50 text-gray-600">로딩…</span></h2>
          <div class="space-y-3">
            <div class="h-5 rounded skeleton"></div>
            <div class="h-5 rounded skeleton"></div>
            <div class="h-5 rounded skeleton"></div>
          </div>`;
        wrap.appendChild(card);
      }
    }

    function renderGroup(sectionEl, group, limit){
      const list=group.items.slice(0,limit);
      const itemsHTML=list.map(item=>`
        <a href="${sanitize(item.link)}" target="_blank" rel="noopener" class="block group">
          <div class="p-3 rounded-xl group-hover:bg-gray-50 transition">
            <h3 class="font-medium leading-snug">${sanitize(item.title)}</h3>
            <p class="text-sm text-gray-600 mt-1 line-clamp-2">${sanitize(item.source)} · ${sanitize(formatTimeKST(item.pubDate))} · <span class="uppercase">${sanitize(item.lang||'')}</span></p>
          </div>
        </a>
      `).join('') || '<p class="text-sm text-gray-500">해당 조건에 맞는 기사가 없습니다.</p>';
      sectionEl.innerHTML=`<h2 class="text-lg font-semibold mb-3">${sanitize(group.title)}</h2><div class="divide-y">${itemsHTML}</div>`;
    }

    function renderAll(groups, targetDate, totalCount){
      const wrap=document.getElementById('results');
      wrap.innerHTML='';
      for(const g of groups){ const sec=document.createElement('section'); sec.className='rounded-2xl bg-white border border-gray-200 p-5 shadow-sm'; renderGroup(sec,g,CONFIG.maxPerCategory); wrap.appendChild(sec); }
      const meta=document.getElementById('meta'); meta.textContent=`${targetDate} 기준(전일 15:00~당일 14:59 KST) 카테고리별 상위 ${CONFIG.maxPerCategory}건 · 총 ${totalCount}건`;
    }

    // ===== FETCH/PARSE =====
    async function fetchRSS(url, langTag){
      try{ const text=await fetchViaProxies(url); const xml=new DOMParser().parseFromString(text,'text/xml'); if(xml.querySelector('parsererror')){ console.warn('parsererror:',url); return []; }
        const items=[...xml.querySelectorAll('item')].map(it=>({
          title: it.querySelector('title')?.textContent?.trim()||'',
          link: it.querySelector('link')?.textContent?.trim()||'',
          description: it.querySelector('description')?.textContent || '',
          pubDateRaw: it.querySelector('pubDate')?.textContent?.trim()||'',
          source: it.querySelector('source')?.textContent?.trim() || it.querySelector('author')?.textContent?.trim() || '출처 미상',
          lang: langTag||''
        }));
        for(const it of items){ const d=new Date(it.pubDateRaw); it.pubDate=isNaN(d)?new Date():d; }
        return items;
      }catch(e){ console.error('fetchRSS error:',e,url); return []; }
    }

    // v2.1 방식 유지: 쿼리별로 병렬 호출(결합 X)
    async function fetchQueries(queries, lang, country, langTag, keyword){
      const qs = queries.map(q => keyword ? `${q} ${keyword}` : q);
      const urls=qs.map(q=>googleNewsRSS(q,lang,country));
      const settled=await Promise.allSettled(urls.map(u=>fetchRSS(u,langTag)));
      return settled.flatMap(s=>s.status==='fulfilled'?s.value:[]);
    }

    async function fetchTopStories(){
      if(!CONFIG.useTopStories) return [];
      const feeds=[ googleTopStoriesRSS(CONFIG.languageKO,CONFIG.countryKO), googleTopStoriesRSS(CONFIG.languageEN,CONFIG.countryUS), googleTopStoriesRSS(CONFIG.languageEN,CONFIG.countryGB) ];
      const settled=await Promise.allSettled(feeds.map(f=>fetchRSS(f,'top')));
      return settled.flatMap(s=>s.status==='fulfilled'?s.value:[]);
    }

    async function fetchOfficialsGlobal(){
      if(!CONFIG.useOfficials) return [];
      const settled=await Promise.allSettled(
        CONFIG.officialFeedsGlobal.map(feed=>
          fetchRSS(feed.url,'official').then(items=>{ items.forEach(it=>it.source=feed.name); return items; })
        )
      );
      return settled.flatMap(s=>s.status==='fulfilled'?s.value:[]);
    }
    async function fetchOfficialsKR(){
      const settled=await Promise.allSettled(
        CONFIG.officialFeedsKR.map(feed=>
          fetchRSS(feed.url,'gov').then(items=>{ items.forEach(it=>it.source=feed.name); return items; })
        )
      );
      return settled.flatMap(s=>s.status==='fulfilled'?s.value:[]);
    }

    function filterAndSort(items, targetDateStr, keyword){
      let filtered=items.filter(it=>inRollingWindowKST(it.pubDate,targetDateStr));
      if(keyword){
        const kw=keyword.toLowerCase();
        filtered=filtered.filter(it=>
          (it.title||'').toLowerCase().includes(kw) || (it.description||'').toLowerCase().includes(kw)
        );
      }
      const titleCount=new Map(); for(const it of filtered){ const k=it.title.toLowerCase(); titleCount.set(k,(titleCount.get(k)||0)+1); }
      return filtered.sort((a,b)=>{ const c=(titleCount.get(b.title.toLowerCase())||1)-(titleCount.get(a.title.toLowerCase())||1); if(c!==0) return c; return b.pubDate-a.pubDate; });
    }

    async function run(targetDateStr){
      try{
        renderSkeleton();
        const keyword=document.getElementById('keywordInput')?.value?.trim();
        const includeBusiness=document.getElementById('toggleBusiness')?.checked;
        const includeGov=document.getElementById('toggleGov')?.checked;
        const applyKeywordTop=document.getElementById('applyKeywordTop')?.checked;
        const applyKeywordGov=document.getElementById('applyKeywordGov')?.checked;

        if(!includeBusiness && !includeGov){
          const emptyGroups=[
            { id:'top', title:'🔥 Top Stories (글로벌 보정)', items:[] },
            ...CONFIG.categories.map(c=>({ id:c.id, title:c.title, items:[] })),
            { id:'officialsKR', title:'🏛️ 국내 공신력 소스(기관 발표)', items:[] },
            { id:'officials', title:'🌐 해외 공신력 소스(기관 발표)', items:[] }
          ];
          renderAll(emptyGroups,targetDateStr,0); return;
        }

        const groups=[]; let total=0;

        // Top stories (키워드 적용 옵션)
        if(includeBusiness){
          const tops=await fetchTopStories();
          const topsFiltered=filterAndSort(dedupe(tops),targetDateStr, applyKeywordTop ? keyword : null).slice(0,CONFIG.maxPerCategory);
          groups.push({ id:'gTop', title:'🗞️ Google Top Stories(ko/en)', items: topsFiltered });
          total+=topsFiltered.length;
        }

        // 글로벌 핫토픽(쿼리 결합 X, 쿼리별 병렬)
        if(includeBusiness){
          const [hotUS,hotGB]=await Promise.all([
            fetchQueries(CONFIG.globalQueries, CONFIG.languageEN, CONFIG.countryUS, 'en', keyword),
            fetchQueries(CONFIG.globalQueries, CONFIG.languageEN, CONFIG.countryGB, 'en', keyword)
          ]);
          const hotFiltered=filterAndSort(dedupe([...hotUS,...hotGB]),targetDateStr, keyword);
          groups.push({ id:'top', title:'🔥 Top Stories (글로벌 보정)', items: hotFiltered });
          total+=Math.min(hotFiltered.length,CONFIG.maxPerCategory);
        }

        // 카테고리 (쿼리별 병렬, v2.1 방식)
        if(includeBusiness){
          const settledCats=await Promise.allSettled(
            CONFIG.categories.map(async cat=>{
              const [koItems,enUSItems,enGBItems]=await Promise.all([
                fetchQueries(cat.queriesKO, CONFIG.languageKO, CONFIG.countryKO, 'ko', keyword),
                fetchQueries(cat.queriesEN, CONFIG.languageEN, CONFIG.countryUS, 'en', keyword),
                fetchQueries(cat.queriesEN, CONFIG.languageEN, CONFIG.countryGB, 'en', keyword)
              ]);
              const merged=dedupe([...koItems,...enUSItems,...enGBItems]);
              const filtered=filterAndSort(merged,targetDateStr, keyword);
              return { id:cat.id, title:cat.title, items: filtered };
            })
          );
          for(const s of settledCats){ if(s.status==='fulfilled'){ groups.push(s.value); total+=Math.min(s.value.items.length,CONFIG.maxPerCategory); } }
        }

        // 국내/해외 기관 (키워드 적용 옵션)
        if(includeGov){
          const offKR=await fetchOfficialsKR();
          const offKRFiltered=filterAndSort(dedupe(offKR),targetDateStr, applyKeywordGov ? keyword : null);
          groups.push({ id:'officialsKR', title:'🏛️ 국내 공신력 소스(기관 발표)', items: offKRFiltered });
          total+=Math.min(offKRFiltered.length,CONFIG.maxPerCategory);
        }
        if(includeGov){
          const offGlobal=await fetchOfficialsGlobal();
          const offGlobalFiltered=filterAndSort(dedupe(offGlobal),targetDateStr, applyKeywordGov ? keyword : null);
          groups.push({ id:'officials', title:'🌐 해외 공신력 소스(기관 발표)', items: offGlobalFiltered });
          total+=Math.min(offGlobalFiltered.length,CONFIG.maxPerCategory);
        }

        renderAll(groups,targetDateStr,total);
      }catch(e){
        console.error(e);
        const fallback=[
          { id:'gTop', title:'🗞️ Google Top Stories(ko/en)', items:[] },
          { id:'top', title:'🔥 Top Stories (글로벌 보정)', items:[] },
          ...CONFIG.categories.map(c=>({ id:c.id, title:c.title, items:[] })),
          { id:'officialsKR', title:'🏛️ 국내 공신력 소스(기관 발표)', items:[] },
          { id:'officials', title:'🌐 해외 공신력 소스(기관 발표)', items:[] }
        ];
        renderAll(fallback,targetDateStr,0);
      }
    }

    function toMarkdownFromDOM(targetDateStr){
      const sections=[...document.querySelectorAll('#results > section')];
      const lines=[`# 데일리 뉴스 브리핑 (${targetDateStr})\n`];
      for(const sec of sections){
        const title=sec.querySelector('h2')?.textContent?.trim()||'';
        lines.push(`## ${title}`);
        const links=[...sec.querySelectorAll('a')];
        if(!links.length){ lines.push('- (해당 조건 기사 없음)\n'); continue; }
        for(const a of links){ const h3=a.querySelector('h3')?.textContent?.trim()||a.href; const meta=a.querySelector('p')?.textContent?.trim()||''; lines.push(`- [${h3}](${a.href}) — ${meta}`);} lines.push('');
      }
      return lines.join('\n');
    }

    // ===== EVENTS =====
    const dateInput=document.getElementById('dateInput');
    const fetchBtn=document.getElementById('fetchBtn');
    const exportBtn=document.getElementById('exportBtn');

    (function initDefaultDateKST(){ const now=new Date(); dateInput.value=toLocalKSTDateString(now); })();
    fetchBtn.addEventListener('click', async()=>{ const d=dateInput.value; if(!d) return alert('날짜를 선택해주세요.'); try{ await run(d);} catch(e){ console.error(e); alert('뉴스를 불러오지 못했습니다.'); }});
    window.addEventListener('DOMContentLoaded',()=>{ renderSkeleton(); if(!dateInput.value) dateInput.value=toLocalKSTDateString(new Date()); fetchBtn.click(); });
    exportBtn.addEventListener('click',()=>{ const md=toMarkdownFromDOM(dateInput.value); const blob=new Blob([md],{type:'text/markdown;charset=utf-8'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`뉴스브리핑_${dateInput.value}.md`; a.click(); setTimeout(()=>URL.revokeObjectURL(url),1000); });
  </script>
</body>
</html>