<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>데일리 뉴스 브리핑 · v2.1R-REBUILD</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .skeleton{position:relative;overflow:hidden;background:#e5e7eb}
    .skeleton::after{content:"";position:absolute;inset:0;transform:translateX(-100%);
      background:linear-gradient(90deg,rgba(229,231,235,0) 0,rgba(255,255,255,.7) 50%,rgba(229,231,235,0) 100%);
      animation:shimmer 1.2s infinite}
    @keyframes shimmer{100%{transform:translateX(100%)}}
    .badge{font-size:.65rem;padding:.2rem .5rem;border-radius:9999px;border:1px solid rgba(0,0,0,.08)}
    .card{border:1px solid rgb(229 231 235); border-radius:1rem; background:white; padding:1.25rem}
    .section-title{font-weight:600; font-size:1.125rem; margin-bottom:.75rem}
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="max-w-7xl mx-auto p-4 sm:p-8">

    <!-- 메인 배너: 이미지 src만 바꾸세요 -->
    <a href="https://omnicare.biz/main/index.php?utm_source=omnicare&utm_medium=news&utm_campaign=daily"
       target="_blank" rel="noopener"
       class="relative block rounded-2xl overflow-hidden border border-gray-200 shadow-sm mb-6"
       aria-label="비타브릿지 건강검진 예약 바로가기">
      <img src="https://postfiles.pstatic.net/MjAyNTA5MDVfMjU2/MDAxNzU3MDM1MzI5ODQ1.uqf71crOiDQYlLsoFGuIKzlASSUil46DsxNDebXlBcYg.wBc6WmhjLSfYDp6xPIF5sznkh50XOkMy-xq0k9GMTV8g.PNG/%EC%98%B4%EB%8B%88%EC%BC%80%EC%96%B4_%EB%A1%9C%EA%B3%A0.png?type=w966"
           alt="건강검진 예약은 비타브릿지"
           class="w-full h-40 sm:h-56 md:h-64 object-cover" />
      <div class="pointer-events-none absolute inset-0 flex items-end">
        <div class="m-4 px-3 py-1.5 rounded-full bg-white/90 text-gray-900 text-xs font-medium shadow">
          건강검진 예약은 비타브릿지
        </div>
      </div>
    </a>

    <!-- 헤더/컨트롤 -->
    <header class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
      <div>
        <h1 class="text-3xl font-semibold tracking-tight">데일리 뉴스 브리핑 <span class="text-xs align-super text-indigo-600">v2.1R-REBUILD</span></h1>
        <p class="text-sm text-gray-500">헬스케어 + 사회·경제·기술·글로벌 이슈. (Recall 우선 · KST 롤링 윈도우)</p>
      </div>
      <div class="flex flex-wrap items-center gap-3">
        <input id="dateInput" type="date" class="px-3 py-2 rounded-xl border border-gray-300 bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500" />
        <input id="keywordInput" type="text" placeholder="검색 키워드 (예: 거래처/제품/인물)" class="px-3 py-2 rounded-xl border border-gray-300 bg-white text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 w-44 sm:w-64" />
        <div class="flex items-center gap-2 text-sm">
          <label class="inline-flex items-center gap-1"><input id="toggleBusiness" type="checkbox" class="rounded" checked> 사업체</label>
          <label class="inline-flex items-center gap-1"><input id="toggleGov" type="checkbox" class="rounded" checked> 국가기관</label>
          <label class="inline-flex items-center gap-1"><input id="applyKeywordTop" type="checkbox" class="rounded"> Top Stories에 키워드 적용</label>
          <label class="inline-flex items-center gap-1"><input id="applyKeywordGov" type="checkbox" class="rounded" checked> 기관에 키워드 적용</label>
        </div>
        <button id="fetchBtn" class="px-4 py-2 rounded-xl bg-indigo-600 text-white text-sm font-medium hover:bg-indigo-700">브리핑 불러오기</button>
        <button id="exportBtn" class="px-4 py-2 rounded-xl bg-gray-800 text-white text-sm font-medium hover:bg-gray-900">Markdown 내보내기</button>
      </div>
    </header>

    <section id="meta" class="mt-4 text-sm text-gray-600"></section>

    <!-- ✅ 섹션을 HTML에 미리 박아둠: JS는 내용만 채움 -->
    <main id="results" class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
      <section id="sec-gTop" class="card"><h2 class="section-title">🗞️ Google Top Stories(ko/en)</h2><div class="space-y-3"><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div></div></section>
      <section id="sec-top"  class="card"><h2 class="section-title">🔥 Top Stories (글로벌 보정)</h2><div class="space-y-3"><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div></div></section>

      <section id="sec-healthcare" class="card"><h2 class="section-title">1) 헬스케어·의료 산업</h2><div class="space-y-3"><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div></div></section>
      <section id="sec-economy"    class="card"><h2 class="section-title">2) 경제·경영 트렌드</h2><div class="space-y-3"><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div></div></section>

      <section id="sec-society"   class="card"><h2 class="section-title">3) 사회·문화 이슈</h2><div class="space-y-3"><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div></div></section>
      <section id="sec-tech"      class="card"><h2 class="section-title">4) 기술·디지털 트렌드</h2><div class="space-y-3"><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div></div></section>

      <section id="sec-global"    class="card"><h2 class="section-title">5) 글로벌 이슈</h2><div class="space-y-3"><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div></div></section>

      <section id="sec-officialsKR" class="card"><h2 class="section-title">🏛️ 국내 공신력 소스(기관 발표)</h2><div class="space-y-3"><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div></div></section>
      <section id="sec-officials"   class="card"><h2 class="section-title">🌐 해외 공신력 소스(기관 발표)</h2><div class="space-y-3"><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div></div></section>
    </main>

    <aside class="mt-8 grid grid-cols-1 lg:grid-cols-3 gap-4 text-xs text-gray-500">
      <div class="card">
        <div class="font-semibold mb-1">버전 노트</div>
        <ul class="list-disc ml-4 space-y-1">
          <li>섹션을 HTML에 <b>고정 렌더</b> → JS 실패/지연 시에도 카드가 항상 보임</li>
          <li>v2.1 방식(Recall) + <b>description 포함</b> 키워드 매칭</li>
          <li>전일 15:00 ~ 당일 14:59 (KST) 롤링 윈도우</li>
          <li>세이프티: 캐시(5분) · 타임아웃 · 프록시 폴백 · 부분 실패 무시</li>
        </ul>
      </div>
      <div class="card">
        <div class="font-semibold mb-1">데이터 소스</div>
        <p>Google News RSS(ko, en-US, en-GB), Google Top Stories, WHO/FDA/EMA/CDC/ACOG/SMFM, 국내: 법제처·보건복지부·식약처·질병관리청.</p>
      </div>
      <div class="card">
        <div class="font-semibold mb-1">Tip</div>
        <p>기관 RSS 주소가 바뀌면 코드 상단 feeds 배열에서 업데이트하세요.</p>
      </div>
    </aside>
  </div>

  <script>
    /* ---------------- CONFIG ---------------- */
    const CONFIG = {
      maxPerSection: 4,
      languageKO: 'ko', countryKO: 'KR',
      languageEN: 'en', countryUS: 'US', countryGB: 'GB',
      globalQueries: [
        'acetaminophen OR paracetamol OR Tylenol OR autism OR ASD OR pregnancy OR Trump',
        'AI health OR medical AI OR digital therapeutics OR wearable health',
        'vaccine safety OR adverse events OR FDA warning OR EMA safety'
      ],
      categories: [
        { id: 'healthcare', el: 'sec-healthcare',
          queriesKO: ['원격의료 OR 디지털 치료제 OR DTx','보건의료 정책 OR 건강보험 OR 급여화','제약바이오 FDA OR 임상 승인 OR 허가'],
          queriesEN: ['telemedicine OR digital therapeutics OR DTx','health policy OR reimbursement OR payer','biotech FDA approval OR clinical trial OR authorization'] },
        { id: 'economy', el: 'sec-economy',
          queriesKO: ['기준금리 OR 금리 동결 OR 인하 OR 인상','환율 OR 외환시장 OR 수출입','M&A OR 스타트업 투자 OR 벤처캐피털'],
          queriesEN: ['interest rate OR central bank decision','FX market OR exchange rate','M&A OR venture capital OR startup funding'] },
        { id: 'society', el: 'sec-society',
          queriesKO: ['고령화 OR 1인 가구 OR 저출산','웰빙 OR 다이어트 트렌드 OR 피트니스','MZ세대 건강 OR 디지털 헬스 소비'],
          queriesEN: ['ageing population OR low birth rate','wellness trend OR fitness culture','consumer health app adoption'] },
        { id: 'tech', el: 'sec-tech',
          queriesKO: ['생성형 AI OR AI 도입 효과 OR 자동화','의료 데이터 보안 OR 개인정보보호 OR GDPR','웨어러블 OR 애플워치 OR 디지털 헬스'],
          queriesEN: ['generative AI OR automation in healthcare','health data security OR HIPAA OR GDPR','wearable health OR Apple Watch OR remote monitoring'] },
        { id: 'global', el: 'sec-global',
          queriesKO: ['공급망 리스크 OR 원자재 OR API 부족','기후 변화 건강 영향 OR 폭염 건강','분쟁 OR 지정학 OR 팬데믹 이후'],
          queriesEN: ['supply chain risk OR API shortage','climate change health impact OR heat wave health','geopolitics OR conflict OR post-pandemic'] },
      ],
      officialFeedsGlobal: [
        { name: 'WHO News', url: 'https://www.who.int/feeds/entity/mediacentre/news/en/rss.xml' },
        { name: 'FDA Press', url: 'https://www.fda.gov/about-fda/contact-fda/press-announcements?rss=1' },
        { name: 'EMA News', url: 'https://www.ema.europa.eu/en/news_events/news?output=rss' },
        { name: 'CDC Newsroom', url: 'https://tools.cdc.gov/api/v2/resources/media/403372.rss' },
        { name: 'ACOG News', url: 'https://www.acog.org/News/news-articles?rss=1' },
        { name: 'SMFM Statements', url: 'https://www.smfm.org/rss' },
      ],
      officialFeedsKR: [
        { name: '법제처 보도자료', url: 'https://www.moleg.go.kr/news/rss' },
        { name: '보건복지부 보도자료', url: 'https://www.mohw.go.kr/rss/press.xml' },
        { name: '식약처 보도자료', url: 'https://www.mfds.go.kr/brd/m_99/rss.do' },
        { name: '질병관리청 보도자료', url: 'https://www.kdca.go.kr/board/rss/boardRss.es?bid=0015' },
      ],
    };

    /* ---------------- UTILS ---------------- */
    const CACHE_TTL_MS = 5 * 60 * 1000;
    function toKST(d){ return new Date(d.getTime() + (9*60 + d.getTimezoneOffset())*60000); }
    function toLocalKSTDateString(d){ return toKST(d).toISOString().slice(0,10); }
    function formatTimeKST(d){ d=toKST(d); const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,'0'),dy=String(d.getDate()).padStart(2,'0'),hh=String(d.getHours()).padStart(2,'0'),mm=String(d.getMinutes()).padStart(2,'0'); return `${y}-${m}-${dy} ${hh}:${mm} KST`; }
    function sanitize(s){ const el=document.createElement('div'); el.textContent=s??''; return el.innerHTML; }
    function getHostname(u){ try{return new URL(u).hostname.replace(/^www\./,'')}catch{return ''} }
    function dedupe(items){ const seen=new Set(); return items.filter(it=>{ const k=(getHostname(it.link)+'|'+it.title).toLowerCase(); if(seen.has(k)) return false; seen.add(k); return true; }); }

    // 전일 15:00 ~ 당일 14:59 (KST)
    function inWindow(pubDate, targetDateStr){
      if(!(pubDate instanceof Date) || isNaN(pubDate)) return false;
      const pivot = new Date(`${targetDateStr}T15:00:00+09:00`);
      const start = new Date(pivot.getTime() - 24*60*60*1000);
      const end   = new Date(pivot.getTime() - 1000);
      return pubDate >= start && pubDate <= end;
    }

    function getCache(key){ try{ const v=sessionStorage.getItem(key); if(!v) return null; const {t,data}=JSON.parse(v); if(Date.now()-t<CACHE_TTL_MS) return data; }catch{} return null; }
    function setCache(key,data){ try{ sessionStorage.setItem(key, JSON.stringify({t:Date.now(),data})); }catch{} }

    function fetchWithTimeout(url, ms=6000, opts={}){ const ctrl=new AbortController(); const id=setTimeout(()=>ctrl.abort(),ms); return fetch(url,{...opts,signal:ctrl.signal}).finally(()=>clearTimeout(id)); }
    async function fetchViaProxies(url){
      const cacheKey=`rss:${url}`; const cached=getCache(cacheKey); if(cached) return cached;
      const targets=[
        `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}&nocache=${Date.now()}`,
        `https://cors.isomorphic-git.org/${url}`,
        `https://thingproxy.freeboard.io/fetch/${url}`
      ];
      let lastErr;
      for(const t of targets){
        try{ const r=await fetchWithTimeout(t,6000); if(!r.ok) throw new Error(`${r.status}`); const text=await r.text(); setCache(cacheKey,text); return text; }
        catch(e){ lastErr=e; }
      }
      throw lastErr||new Error('proxy failed');
    }

    function googleNewsRSS(q,lang,country){ const base='https://news.google.com/rss/search'; const p=new URLSearchParams({q,hl:lang,gl:country,ceid:`${country}:${lang}`}); return `${base}?${p.toString()}`; }
    function googleTopStoriesRSS(lang,country){ const base='https://news.google.com/rss'; const p=new URLSearchParams({hl:lang,gl:country,ceid:`${country}:${lang}`}); return `${base}?${p.toString()}`; }

    /* ---------------- RENDER HELPERS ---------------- */
    function setSectionLoading(id){ const el=document.getElementById(id); if(!el) return; el.querySelector(':scope > div').innerHTML =
      '<div class="space-y-3"><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div><div class="h-5 rounded skeleton"></div></div>'; }

    function renderItems(id, items){
      const el=document.getElementById(id);
      if(!el) return;
      const box = el.querySelector(':scope > div');
      if(!items || !items.length){
        box.innerHTML = '<p class="text-sm text-gray-500">해당 조건에 맞는 기사가 없습니다.</p>';
        return;
      }
      const html = items.slice(0, CONFIG.maxPerSection).map(it=>(
        `<a href="${sanitize(it.link)}" target="_blank" rel="noopener" class="block group">
           <div class="p-3 rounded-xl group-hover:bg-gray-50 transition">
             <h3 class="font-medium leading-snug">${sanitize(it.title)}</h3>
             <p class="text-sm text-gray-600 mt-1">${sanitize(it.source)} · ${sanitize(formatTimeKST(it.pubDate))} · <span class="uppercase">${sanitize(it.lang||'')}</span></p>
           </div>
         </a>`
      )).join('');
      box.innerHTML = `<div class="divide-y">${html}</div>`;
    }

    /* ---------------- PARSE ---------------- */
    async function parseRSS(url, langTag){
      try{
        const text=await fetchViaProxies(url);
        const xml=new DOMParser().parseFromString(text,'text/xml');
        if(xml.querySelector('parsererror')) return [];

        let items=[...xml.querySelectorAll('item')].map(x=>({
          title: x.querySelector('title')?.textContent?.trim() || '',
          link: x.querySelector('link')?.textContent?.trim() || '',
          description: x.querySelector('description')?.textContent || '',
          pubDateRaw: x.querySelector('pubDate')?.textContent?.trim()
                   || x.querySelector('dc\\:date')?.textContent?.trim()
                   || x.querySelector('updated')?.textContent?.trim() || '',
          source: x.querySelector('source')?.textContent?.trim()
               || x.querySelector('author')?.textContent?.trim() || '출처 미상',
          lang: langTag || ''
        })];

        if(items.length===0){
          items=[...xml.querySelectorAll('entry')].map(e=>{
            const linkEl=e.querySelector('link[rel="alternate"]')||e.querySelector('link');
            return {
              title: e.querySelector('title')?.textContent?.trim()||'',
              link: linkEl?.getAttribute('href')||'',
              description: e.querySelector('summary')?.textContent||'',
              pubDateRaw: e.querySelector('updated')?.textContent?.trim() || e.querySelector('published')?.textContent?.trim() || '',
              source: '공식', lang: langTag||''
            };
          });
        }
        for(const it of items){ const d=new Date(it.pubDateRaw); it.pubDate=isNaN(d)?new Date(0):d; }
        return items;
      }catch{ return []; }
    }

    async function fetchQueries(qs, lang, country, tag, keyword){
      const arr = qs.map(q => keyword ? `${q} ${keyword}` : q);
      const urls = arr.map(q => googleNewsRSS(q, lang, country));
      const settled = await Promise.allSettled(urls.map(u => parseRSS(u, tag)));
      return settled.flatMap(s => s.status==='fulfilled' ? s.value : []);
    }

    async function fetchTopStoriesAll(){
      const feeds=[
        googleTopStoriesRSS(CONFIG.languageKO, CONFIG.countryKO),
        googleTopStoriesRSS(CONFIG.languageEN, CONFIG.countryUS),
        googleTopStoriesRSS(CONFIG.languageEN, CONFIG.countryGB),
      ];
      const settled = await Promise.allSettled(feeds.map(u=>parseRSS(u,'top')));
      return settled.flatMap(s => s.status==='fulfilled' ? s.value : []);
    }

    async function fetchOfficialsKR(){
      const settled = await Promise.allSettled(
        CONFIG.officialFeedsKR.map(f => parseRSS(f.url,'gov').then(items => { items.forEach(i=>i.source=f.name); return items; }))
      );
      return settled.flatMap(s => s.status==='fulfilled' ? s.value : []);
    }
    async function fetchOfficialsGlobal(){
      const settled = await Promise.allSettled(
        CONFIG.officialFeedsGlobal.map(f => parseRSS(f.url,'official').then(items => { items.forEach(i=>i.source=f.name); return items; }))
      );
      return settled.flatMap(s => s.status==='fulfilled' ? s.value : []);
    }

    /* ---------------- FILTER ---------------- */
    function applyFilters(items, dateStr, keyword){
      let arr = items.filter(it => inWindow(it.pubDate, dateStr));
      if(keyword){
        const tokens = keyword.split(/[ ,|]+/).map(s=>s.toLowerCase()).filter(Boolean);
        arr = arr.filter(it => {
          const text = ((it.title||'') + ' ' + (it.description||'')).toLowerCase();
          return tokens.some(t => text.includes(t));
        });
      }
      const cover = new Map();
      for(const it of arr){ const k = it.title.toLowerCase(); cover.set(k,(cover.get(k)||0)+1); }
      return arr.sort((a,b)=>{
        const c = (cover.get(b.title.toLowerCase())||1) - (cover.get(a.title.toLowerCase())||1);
        return c!==0 ? c : (b.pubDate - a.pubDate);
      });
    }

    /* ---------------- RUN ---------------- */
    async function run(){
      // UI 값
      const dateStr = document.getElementById('dateInput').value;
      const keyword = document.getElementById('keywordInput').value.trim();
      const includeBiz = document.getElementById('toggleBusiness').checked;
      const includeGov = document.getElementById('toggleGov').checked;
      const kwTop = document.getElementById('applyKeywordTop').checked;
      const kwGov = document.getElementById('applyKeywordGov').checked;

      // 섹션을 로딩 상태로
      ['sec-gTop','sec-top','sec-healthcare','sec-economy','sec-society','sec-tech','sec-global','sec-officialsKR','sec-officials']
        .forEach(setSectionLoading);

      let totalShown = 0;

      try{
        // Google Top Stories
        if(includeBiz){
          const topAll = await fetchTopStoriesAll();
          const topFiltered = applyFilters(dedupe(topAll), dateStr, kwTop ? keyword : null).slice(0, CONFIG.maxPerSection);
          renderItems('sec-gTop', topFiltered);
          totalShown += topFiltered.length;
        } else {
          renderItems('sec-gTop', []);
        }

        // 글로벌 핫토픽
        if(includeBiz){
          const [hotUS, hotGB] = await Promise.all([
            fetchQueries(CONFIG.globalQueries, CONFIG.languageEN, CONFIG.countryUS, 'en', keyword),
            fetchQueries(CONFIG.globalQueries, CONFIG.languageEN, CONFIG.countryGB, 'en', keyword),
          ]);
          const hot = applyFilters(dedupe([...hotUS, ...hotGB]), dateStr, keyword);
          renderItems('sec-top', hot);
          totalShown += Math.min(hot.length, CONFIG.maxPerSection);
        } else {
          renderItems('sec-top', []);
        }

        // 카테고리
        if(includeBiz){
          await Promise.all(CONFIG.categories.map(async cat=>{
            const [ko, enUS, enGB] = await Promise.all([
              fetchQueries(cat.queriesKO, CONFIG.languageKO, CONFIG.countryKO, 'ko', keyword),
              fetchQueries(cat.queriesEN, CONFIG.languageEN, CONFIG.countryUS, 'en', keyword),
              fetchQueries(cat.queriesEN, CONFIG.languageEN, CONFIG.countryGB, 'en', keyword),
            ]);
            const merged = dedupe([...ko, ...enUS, ...enGB]);
            const filt = applyFilters(merged, dateStr, keyword);
            renderItems(`sec-${cat.id}`, filt);
            totalShown += Math.min(filt.length, CONFIG.maxPerSection);
          }));
        } else {
          CONFIG.categories.forEach(cat => renderItems(`sec-${cat.id}`, []));
        }

        // 기관
        if(includeGov){
          const offKR = await fetchOfficialsKR();
          renderItems('sec-officialsKR', applyFilters(dedupe(offKR), dateStr, kwGov ? keyword : null));
        } else {
          renderItems('sec-officialsKR', []);
        }
        if(includeGov){
          const offGlobal = await fetchOfficialsGlobal();
          renderItems('sec-officials', applyFilters(dedupe(offGlobal), dateStr, kwGov ? keyword : null));
        } else {
          renderItems('sec-officials', []);
        }
      }catch(e){
        console.error(e);
        // 실패 시에도 섹션은 유지됨
      }

      document.getElementById('meta').textContent =
        `${dateStr} 기준(전일 15:00~당일 14:59 KST) 섹션별 상위 ${CONFIG.maxPerSection}건 · 대략 ${totalShown}건 표시`;
    }

    /* ---------------- EXPORT ---------------- */
    function toMarkdown(){
      const dateStr = document.getElementById('dateInput').value;
      const sections = [
        'sec-gTop','sec-top','sec-healthcare','sec-economy','sec-society','sec-tech','sec-global','sec-officialsKR','sec-officials'
      ];
      const names = {
        'sec-gTop':'Google Top Stories(ko/en)', 'sec-top':'Top Stories(글로벌 보정)',
        'sec-healthcare':'1) 헬스케어·의료 산업','sec-economy':'2) 경제·경영 트렌드',
        'sec-society':'3) 사회·문화 이슈','sec-tech':'4) 기술·디지털 트렌드',
        'sec-global':'5) 글로벌 이슈','sec-officialsKR':'국내 공신력 소스(기관 발표)','sec-officials':'해외 공신력 소스(기관 발표)'
      };
      const lines = [`# 데일리 뉴스 브리핑 (${dateStr})\n`];
      for(const id of sections){
        const sec = document.getElementById(id);
        const title = names[id] || sec.querySelector('h2')?.textContent?.trim() || id;
        lines.push(`## ${title}`);
        const links = [...sec.querySelectorAll('a')];
        if(!links.length){ lines.push('- (해당 조건 기사 없음)\n'); continue; }
        for(const a of links){
          const h3 = a.querySelector('h3')?.textContent?.trim() || a.href;
          const meta = a.querySelector('p')?.textContent?.trim() || '';
          lines.push(`- [${h3}](${a.href}) — ${meta}`);
        }
        lines.push('');
      }
      return lines.join('\n');
    }

    /* ---------------- BOOT ---------------- */
    const dateInput = document.getElementById('dateInput');
    const fetchBtn  = document.getElementById('fetchBtn');
    const exportBtn = document.getElementById('exportBtn');

    function init(){
      if(!dateInput.value) dateInput.value = toLocalKSTDateString(new Date());
      // 처음에도 즉시 로딩
      run();
      // 버튼 이벤트
      fetchBtn.addEventListener('click', run);
      exportBtn.addEventListener('click', ()=>{
        const md = toMarkdown();
        const blob = new Blob([md], {type:'text/markdown;charset=utf-8'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = `뉴스브리핑_${dateInput.value}.md`; a.click();
        setTimeout(()=>URL.revokeObjectURL(url), 1000);
      });
    }

    if(document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
